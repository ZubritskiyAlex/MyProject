import {
    FETCH_PRODUCTS_START,
    FETCH_PRODUCTS_SUCCESS,
    FETCH_PRODUCTS_FAILURE,
    LOAD_MORE_PRODUCTS_SUCCESS,
    LOAD_MORE_PRODUCTS_FAILURE,
    LOAD_MORE_PRODUCTS_START,
    FETCH_PRODUCT_BY_ID_START,
    FETCH_PRODUCT_BY_ID_SUCCESS,
    FETCH_PRODUCT_BY_ID_FAILURE,
    ADD_PHONE_TO_BASKET,
    SEARCH_PHONE
} from 'reducers/actionTypes'

import  {fetchProducts as fetchProductsApi,
            loadMoreProducts as loadMoreProductsApi,
    fetchProductById as fetchProductByIdApi} from 'api'
import {getRenderedProductsLength} from 'selectors'


export const fetchProducts = () => async dispatch => {
dispatch({
    type: FETCH_PRODUCTS_START
})
try{
    const products = await fetchProductsApi()
    dispatch({
        type: FETCH_PRODUCTS_SUCCESS,
        payload: products
    })
} catch (err){
    dispatch({
        type: FETCH_PRODUCTS_FAILURE,
        payload: err,
        error: true
    })
 }
}

export const fetchProductById = id => async dispatch =>{
    dispatch({ type: FETCH_PRODUCT_BY_ID_START})

    try{
        const product = await fetchProductByIdApi(id)
        dispatch({
            type: FETCH_PRODUCT_BY_ID_SUCCESS,
            payload: product
        })
    }catch (err) {
        dispatch({
            type: FETCH_PRODUCT_BY_ID_FAILURE,
            payload: err,
            error: true
        })
    }
}

export const loadMoreProducts = () => async (dispatch, getState) => {
    const offset = getRenderedProductsLength(getState())
    dispatch({
        type: LOAD_MORE_PRODUCTS_START
    })

    try {
        const products = await loadMoreProductsApi({offset})
        dispatch({
            type: LOAD_MORE_PRODUCTS_SUCCESS,
            payload: products
        })
    } catch (err){
      dispatch({
          type: LOAD_MORE_PRODUCTS_FAILURE,
          payload: err,
          error: true
      })
    }
}

export const searchPhone = text => dispatch => {
    dispatch({
        type: SEARCH_PHONE,
        payload: text
    })
}

export const addProductToBasket = id => dispatch => {
    dispatch({
        type: ADD_PHONE_TO_BASKET,
        payload: id
    })
}

